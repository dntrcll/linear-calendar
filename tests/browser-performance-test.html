<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendar Performance Test</title>
  <style>
    body {
      font-family: 'Monaco', 'Courier New', monospace;
      background: #1a1a1a;
      color: #00ff00;
      padding: 20px;
      line-height: 1.6;
    }
    h1 {
      color: #00ff00;
      border-bottom: 2px solid #00ff00;
      padding-bottom: 10px;
    }
    .test-section {
      background: #2a2a2a;
      padding: 15px;
      margin: 15px 0;
      border-left: 3px solid #00ff00;
    }
    .result {
      margin: 5px 0;
      padding: 5px;
      background: #333;
    }
    .warning {
      color: #ff9900;
    }
    .error {
      color: #ff3300;
    }
    .success {
      color: #00ff00;
    }
    button {
      background: #00ff00;
      color: #1a1a1a;
      border: none;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
      margin: 5px;
      font-weight: bold;
    }
    button:hover {
      background: #00cc00;
    }
    pre {
      background: #000;
      padding: 10px;
      overflow-x: auto;
      border: 1px solid #00ff00;
    }
  </style>
</head>
<body>
  <h1>üìä Calendar Performance Test Suite</h1>
  <p>Run this test to measure calendar performance under different event loads</p>

  <div>
    <button onclick="runAllTests()">Run All Tests</button>
    <button onclick="clearResults()">Clear Results</button>
  </div>

  <div id="results"></div>

  <script>
    const resultsDiv = document.getElementById('results');

    function log(message, type = 'info') {
      const className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'success';
      resultsDiv.innerHTML += `<div class="result ${className}">${message}</div>`;
    }

    function clearResults() {
      resultsDiv.innerHTML = '';
    }

    function generateMockEvents(count) {
      const events = [];
      const startDate = new Date('2024-01-01');
      const categories = ['work', 'health', 'social', 'learning', 'other'];
      const contexts = ['personal', 'family'];

      for (let i = 0; i < count; i++) {
        const start = new Date(startDate.getTime() + (i * 3600000));
        const end = new Date(start.getTime() + 1800000);

        events.push({
          id: `event-${i}`,
          title: `Event ${i}`,
          description: `Description for event ${i}`,
          location: i % 5 === 0 ? `Location ${i}` : '',
          category: categories[i % categories.length],
          context: contexts[i % contexts.length],
          start: start.toISOString(),
          end: end.toISOString(),
          deleted: false
        });
      }

      return events;
    }

    function measureEventFiltering(events) {
      const startTime = performance.now();

      // Simulate filtering
      const filtered = events.filter(e => {
        const matchesContext = e.context === 'personal';
        const matchesDeleted = !e.deleted;
        return matchesContext && matchesDeleted;
      });

      // Simulate sorting
      const sorted = filtered.sort((a, b) =>
        new Date(a.start).getTime() - new Date(b.start).getTime()
      );

      const endTime = performance.now();

      return {
        duration: endTime - startTime,
        totalEvents: events.length,
        filteredEvents: sorted.length
      };
    }

    function measureConflictDetection(events) {
      const startTime = performance.now();

      const conflicts = [];
      for (let i = 0; i < events.length - 1; i++) {
        for (let j = i + 1; j < events.length; j++) {
          const event1 = events[i];
          const event2 = events[j];

          const start1 = new Date(event1.start).getTime();
          const end1 = new Date(event1.end).getTime();
          const start2 = new Date(event2.start).getTime();
          const end2 = new Date(event2.end).getTime();

          if (start1 < end2 && start2 < end1) {
            conflicts.push([event1.id, event2.id]);
          }

          if (start2 >= end1) break;
        }
      }

      const endTime = performance.now();

      return {
        duration: endTime - startTime,
        conflictCount: conflicts.length
      };
    }

    function runTest(eventCount) {
      resultsDiv.innerHTML += `<div class="test-section"><h3>Testing with ${eventCount} events</h3>`;

      // Generate events
      const genStart = performance.now();
      const events = generateMockEvents(eventCount);
      const genEnd = performance.now();

      log(`Generated ${eventCount} events in ${(genEnd - genStart).toFixed(2)}ms`);

      // Test filtering
      const filterResult = measureEventFiltering(events);
      log(`Filtered ${filterResult.totalEvents} ‚Üí ${filterResult.filteredEvents} events in ${filterResult.duration.toFixed(2)}ms`);

      if (filterResult.duration > 100) {
        log(`‚ö†Ô∏è WARNING: Filtering is slow (${filterResult.duration.toFixed(2)}ms > 100ms)`, 'warning');
        log(`TODO: Consider using useMemo() or optimizing filter logic`, 'warning');
      }

      // Test conflict detection
      const conflictResult = measureConflictDetection(events);
      log(`Detected ${conflictResult.conflictCount} conflicts in ${conflictResult.duration.toFixed(2)}ms`);

      if (conflictResult.duration > 500) {
        log(`‚ö†Ô∏è WARNING: Conflict detection is slow (${conflictResult.duration.toFixed(2)}ms > 500ms)`, 'warning');
        log(`TODO: Use interval tree or sweep line algorithm for O(n log n) performance`, 'warning');
      }

      // Overall assessment
      const totalTime = genEnd - genStart + filterResult.duration + conflictResult.duration;
      log(`Total processing time: ${totalTime.toFixed(2)}ms`);

      if (totalTime > 1000) {
        log(`‚ùå ERROR: Total time exceeds 1 second`, 'error');
        log(`TODO: Implement virtualization and lazy loading`, 'error');
      } else if (totalTime > 500) {
        log(`‚ö†Ô∏è WARNING: Performance degradation detected`, 'warning');
      } else {
        log(`‚úÖ Performance is acceptable`, 'success');
      }

      resultsDiv.innerHTML += `</div>`;
    }

    function runAllTests() {
      clearResults();

      resultsDiv.innerHTML += `<h2>Starting Performance Test Suite</h2>`;
      resultsDiv.innerHTML += `<p>Timestamp: ${new Date().toLocaleString()}</p>`;

      const testCases = [100, 1000, 5000];

      testCases.forEach(count => {
        runTest(count);
      });

      resultsDiv.innerHTML += `<div class="test-section"><h3>Summary</h3>`;
      log('All tests complete. Review warnings and errors above.', 'info');
      resultsDiv.innerHTML += `</div>`;
    }

    // Auto-run on load
    window.addEventListener('load', () => {
      log('Performance test suite ready. Click "Run All Tests" to begin.', 'info');
    });
  </script>
</body>
</html>
